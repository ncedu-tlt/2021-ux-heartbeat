<div class="container">
  <div class="player" *ngIf="!drawerVisible">
    <div class="player__current-track" *ngIf="playerService.currentTrackInfo$.getValue()"
         (click)="openPlayerControlOnMobile(playerService.currentTrackInfo$.getValue()!.id)">
      <img [routerLink]="['/album', playerService.currentTrackInfo$.getValue()!.album!.id]"
           src="{{playerService.currentTrackInfo$.getValue()!.album!.images[0].url}}" alt="#">
      <div class="player__info-about-track">
        <div class="player__artist-name">
              <p *ngIf="artistsNames">
                {{artistsNames}}
              </p>
        </div>
        <span class="player__track-name">{{playerService.currentTrackInfo$.getValue()!.name}}</span>
      </div>
    </div>
    <div class="player__control">
      <div class="player__control-items">
        <button class="player__previous-track" (click)="this.playerService.switchTrack(actions.SWITCH_PREVIOUS)">
          <object
            type="image/svg+xml"
            data="../../../assets/svg/previous.svg"
            width="20px"
            height="20px"
          ></object>
        </button>
        <button *ngIf="!(playerService.isPlay$ | async)" class="player__play" (click)="playerService.switchPlayerAction()">
          <object
            type="image/svg+xml"
            data="../../../assets/svg/play.svg"
            width="20px"
            height="20px"
          ></object>
        </button>
        <button class="player__pause" *ngIf="playerService.isPlay$ | async" (click)="playerService.switchPlayerAction()">
          <object
            type="image/svg+xml"
            data="../../../assets/svg/pause.svg"
            width="20px"
            height="20px"
          ></object>
        </button>
        <button class="player__next-track" (click)="playerService.switchTrack(actions.SWITCH_NEXT)">
          <object
            type="image/svg+xml"
            data="../../../assets/svg/next.svg"
            width="20px"
            height="20px"
          ></object>
        </button>
      </div>
      <div class="player__progress" *ngIf="!isMobile">
        <nz-progress nzTooltipPlacement="topLeft"
                     [nzTooltipOverlayStyle]="playerService.currentTooltipPosition"
                     nz-tooltip=""
                     [nzTooltipTitle]="playerService.currentTrackInfo$.getValue() ? (playerService.timeOnTooltip$ | async | timeFormat) : null"
                     [nzPercent]=playerService.currentPositionOnProgressBar
                     [nzShowInfo]="false"
                     nzStatus="active"
                     class="player__progress-bar"
                     (click)="playerService.changeMusicProgress($event)"
                     (mousemove)="playerService.changeTooltipPosition($event)">
        </nz-progress>
        <span class="player__time">
          {{playerService.musicCurrentTime$.getValue() | timeFormat}}
      </span>
      </div>
    </div>
    <div class="player__extra-control" *ngIf="!isMobile">
      <button class="player__volume" *ngIf="playerService.player.volume"
              (click)="playerService.controlMusicVolume()">
        <object
          type="image/svg+xml"
          data="../../../assets/svg/volume.svg"
          width="15px"
          height="15px"
        ></object>
      </button>
      <button class="player__volume" *ngIf="!playerService.player.volume"
              (click)="playerService.controlMusicVolume()">
        <object
          type="image/svg+xml"
          data="../../../assets/svg/no-volume.svg"
          width="15px"
          height="15px"
        ></object>
      </button>
      <nz-progress [nzShowInfo]="false"
                   [nzPercent]="playerService.musicVolume$ | async"
                   nzStatus="normal"
                   class="player__volume-bar"
                   (click)="playerService.changeMusicVolume($event)">
      </nz-progress>
      <button class="player__mixing" (click)="playerService.mixCurrentTrackList()">
        <object
          type="image/svg+xml"
          data="../../../assets/svg/mixing.svg"
          width="15px"
          height="15px"
        ></object>
      </button>
      <button class="player__no-repeat" *ngIf="playerService.isRepeat === 0"
              (click)="playerService.putOnRepeat()">
        <object
          type="image/svg+xml"
          data="../../../assets/svg/repeat.svg"
          width="15px"
          height="15px"
        ></object>
      </button>
      <button class="player__repeat" *ngIf="playerService.isRepeat === 1"
              (click)="playerService.putOnRepeat()">
        <object
          type="image/svg+xml"
          data="../../../assets/svg/repeat-playlist.svg"
          width="15px"
          height="15px"
        ></object>
      </button>
      <button class="player__repeat" *ngIf="playerService.isRepeat === 2"
              (click)="playerService.putOnRepeat()">
        <object
          type="image/svg+xml"
          data="../../../assets/svg/repeat-active.svg"
          width="15px"
          height="15px"
        ></object>
      </button>
      <button nz-dropdown [nzDropdownMenu]="menu"
              [disabled]="!playerService.currentTrackInfo$.getValue() || !authService.getAuthToken()"
              (click)="getUserPlaylists(playerService.currentTrackInfo$.getValue()!.id)"
              nzTrigger="click"
              nzPlacement = "topCenter"
              class="player__add-track">
        <object
          type="image/svg+xml"
          data="../../../assets/svg/add.svg"
          width="15px"
          height="15px"
        ></object>
      </button>
      <button class="player__music-list">
        <object
          type="image/svg+xml"
          data="../../../assets/svg/music-list.svg"
          width="15px"
          height="15px"
        ></object>
      </button>
    </div>
    <nz-dropdown-menu #menu="nzDropdownMenu">
      <ul nz-menu>
        <li nz-menu-item *ngIf="!isFavorite"
            (click)="addTrackIntoFavoriteList(playerService.currentTrackInfo$.getValue()!.id)">
          Добавить в избранное
        </li>
        <li nz-menu-item
            *ngIf="isFavorite"
            (click)="removeTrackFromFavoriteList(playerService.currentTrackInfo$.getValue()!.id)">
          Убрать из избранного
        </li>
        <li nz-submenu nzTitle="Добавить в плейлист">
          <ul>
            <li nz-menu-item
                *ngFor="let playlist of userPlaylists"
                (click)="addTrackIntoPlaylist(playlist.id, playerService.currentTrackInfo$.getValue()!.id)">
              {{playlist.name}}
            </li>
          </ul>
        </li>
      </ul>
    </nz-dropdown-menu>
  </div>
  <div class="player" *ngIf="!drawerVisible">
  </div>
  <div class="mobile-player" *ngIf="isMobile && playerService.currentTrackInfo$.getValue()">
    <nz-drawer
      nzWrapClassName="mobile-player-drawer"
      [nzClosable]="false"
      nzPlacement="bottom"
      nzHeight="615px"
      [nzVisible]="drawerVisible"
      (nzOnClose)="closePlayerControlOnMobile()"
    >
      <ng-container class="mobile-player-contain" *nzDrawerContent>
        <div class="mobile-player-contain__current-track">
          <img src="{{playerService.currentTrackInfo$.getValue()!.album!.images[0].url}}" alt="#" class="mobile-player-contain__img">
          <div class="mobile-player-contain__info-about-track">
          <div class="mobile-player-contain__artist-name">
            <p *ngIf="artistsNames">
              {{artistsNames}}
            </p>
          </div>
            <span class="mobile-player-contain__track-name">{{playerService.currentTrackInfo$.getValue()!.name}}</span>
          </div>
        </div>
        <div class="mobile-player-contain__progress">
          <nz-progress
            [nzPercent]=playerService.currentPositionOnProgressBar
            [nzShowInfo]="false"
            nzStatus="active"
            class="mobile-player-contain__progress-bar"
            (click)="playerService.changeMusicProgress($event)"
            (mousemove)="playerService.changeTooltipPosition($event)">
          </nz-progress>
          <span class="mobile-player-contain__time">
          {{playerService.musicCurrentTime$.getValue() | timeFormat}}
      </span>
        </div>
        <div class="mobile-player-contain__control">
          <div class="mobile-player-contain__control-items">
            <button class="mobile-player-contain__previous-track" (click)="this.playerService.switchTrack(actions.SWITCH_PREVIOUS)">
              <object
                type="image/svg+xml"
                data="../../../assets/svg/previous.svg"
                width="30px"
                height="30px"
              ></object>
            </button>
            <button *ngIf="!(playerService.isPlay$ | async)" class="mobile-player-contain__play" (click)="playerService.switchPlayerAction()">
              <object
                type="image/svg+xml"
                data="../../../assets/svg/play.svg"
                width="35px"
                height="35px"
              ></object>
            </button>
            <button class="mobile-player-contain__pause" *ngIf="playerService.isPlay$ | async" (click)="playerService.switchPlayerAction()">
              <object
                type="image/svg+xml"
                data="../../../assets/svg/pause.svg"
                width="35px"
                height="35px"
              ></object>
            </button>
            <button class="mobile-player-contain__next-track" (click)="this.playerService.switchTrack(actions.SWITCH_NEXT)">
              <object
                type="image/svg+xml"
                data="../../../assets/svg/next.svg"
                width="30px"
                height="30px"
              ></object>
            </button>
          </div>
        </div>
        <div class="mobile-player-contain__extra-control">
          <button class="mobile-player-contain__mixing">
            <object
              type="image/svg+xml"
              data="../../../assets/svg/mixing.svg"
              width="25px"
              height="25px"
            ></object>
          </button>
          <button class="mobile-player-contain__no-repeat" *ngIf="playerService.isRepeat === 0"
                  (click)="playerService.putOnRepeat()">
            <object
              type="image/svg+xml"
              data="../../../assets/svg/repeat.svg"
              width="25px"
              height="25px"
            ></object>
          </button>
          <button class="mobile-player-contain__repeat" *ngIf="playerService.isRepeat === 1"
                  (click)="playerService.putOnRepeat()">
            <object
              type="image/svg+xml"
              data="../../../assets/svg/repeat-active.svg"
              width="25px"
              height="25px"
            ></object>
          </button>
          <button class="player__repeat" *ngIf="playerService.isRepeat === 2"
                  (click)="playerService.putOnRepeat()">
            <object
              type="image/svg+xml"
              data="../../../assets/svg/repeat-active.svg"
              width="15px"
              height="15px"
            ></object>
          </button>
          <button class="mobile-player-contain__add-track"
                  *ngIf="!isFavorite"
                  [disabled]="!playerService.currentTrackInfo$.getValue() || !authService.getAuthToken()"
                  (click)="addTrackIntoFavoriteList(playerService.currentTrackInfo$.getValue()!.id)">
            <object
              type="image/svg+xml"
              data="../../../assets/svg/favorite.svg"
              width="25px"
              height="25px"
            ></object>
          </button>
          <button class="mobile-player-contain__delete-track"
                  *ngIf="isFavorite"
                  [disabled]="!playerService.currentTrackInfo$.getValue() || !authService.getAuthToken()"
                  (click)="removeTrackFromFavoriteList(playerService.currentTrackInfo$.getValue()!.id)">
            <object
              type="image/svg+xml"
              data="../../../assets/svg/fill-heart.svg"
              width="25px"
              height="25px"
            ></object>
          </button>
          <button class="mobile-player-contain__music-list">
            <object
              type="image/svg+xml"
              data="../../../assets/svg/music-list.svg"
              width="25px"
              height="25px"
            ></object>
          </button>
        </div>
      </ng-container>
    </nz-drawer>
  </div>
</div>
